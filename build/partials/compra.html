<style type="text/css">
  .errorForm{
    display: block;
    text-align: center;
    margin-top: 5px;
    margin-bottom: 30px;
    font-family: 'Gotham-Bold';
    color: red;
    display: none;
  }
  .ocultednextstep{
    display: none;
  }
  .mensajeaddcupon{
    font-family: 'Gotham-Bold';
  }
  .spaceinputcupon{
    margin-top: 5px;
    margin-bottom: 5px;
  }
  .spaceinputcupon div{
    width: 50%;
    margin-top: 5px;
    margin-bottom: 5px;
  }
  .spaceinputcupon div input{
    border: 2px solid rgb(229, 229, 229);
    padding: 5px;
    font-family: 'Gotham-Book';
    outline: none;
  }
  .spaceinputcupon div span{
    color: red;
    font-size: .9em;
    font-family: 'Gotham-Bold';
  }
  .spaceinputcupon div button{
    margin-top: 5px;
    width: auto;
    padding-top: 10px 15px;
    border: 2px solid rgb(229, 229, 229);
    background-color: rgb(229, 229, 229);
    color: #000;
    outline: none;
    font-size: .9em;
  }
  .spaceinputcupon div button:hover{
    cursor: pointer;
    opacity: .5;
  }
</style>
<div class="row partial-container shop-stage-buy">
  
  <div class="shopping-cart" ng-controller="shoppingCartController" ng-show="getCount()!=0">

    <!-- Menu -->
    <div class="status-compra">
      <div class="title-status step-2" ng-click="changeItemBuy(1)" ng-class="{'selected-status': itemselected === 1, 'unselected-status': itemselected != 1 }">INFORMACIÓN DEL CLIENTE</div>
      <div class="title-status step-4" ng-click="changeItemBuy(2)" ng-class="{'selected-status': itemselected === 2, 'unselected-status': itemselected != 2 }">DATOS DE ENVÍO</div>
      <div class="title-status step-1" ng-click="changeItemBuy(3)" ng-class="{'selected-status': itemselected === 3, 'unselected-status': itemselected != 3 }">CONFIRMAR ORDEN</div>
    </div>

  
    <!-- INFORMACIÓN DEL CLIENTE -->
    <div class="compra-wrapper client-info-wrapper show-form" ng-show="itemselected === 1">
      <div class="client-info" ng-show="userDataLoaded">
        <h2 class="compra-title">INFORMACIÓN DEL CLIENTE</h2>
        <div class="user-data" ng-controller="selectedStatesCitiesController">
          <!-- Nombre -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>NOMBRE</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="name" value="{{userData.username}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Apellido -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>APELLIDOS</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="lastname" value="{{userData.userlastname}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- E-MAIL -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>E-MAIL</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="email" value="{{userData.useremail}}" data-email="{{userData.useremail}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Teléfono  -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>TELÉFONO</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="phone" value="{{userData.userphonenumber}}" class="profile-input" readonly="true" data-status="acepted" disabled >
              <span class="msgError"></span>
            </div>
          </div>
          <!-- ESTADO -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>ESTADO</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" readonly="true" ng-model="userState" ng-change="changeState(userState)" data-status="acepted" disabled name="state">
                <option ng-repeat="(key, data) in states" name="{{data.idEstados}}" value="{{data.idEstados}}">{{data.nombreEstado | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CIUDAD -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CIUDAD</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" readonly="true" ng-model="userCity" ng-change="changeCity(userCity)" data-status="acepted" disabled name="city">
                <option ng-repeat="(key, data) in cities" ng-if="data.Estados_idEstados ===  userState" name="{{data.idCiudades}}" value="{{data.idCiudades}}">{{data.nombreCiudad | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CALLE -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>DIRECCIÓN</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="address" value="{{userData.useraddress}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- C.P. -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CÓDIGO POSTAl</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="postalcode" value="{{userData.userzipcode}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
        </div>
        <div class="button-next-wrapper">
          <span class="button-next" ng-click="changeStage(2)">
            SIGUIENTE
          </span>
        </div>
        <div class="message-goto-user">
          En dado caso de que tus datos sean incorrectos, ve a <a href="./#/profile">perfil</a> para cambiarlos. 
        </div>
      </div>
    </div>

    <!-- DATOS DE ENVÍO -->
    <div class="compra-wrapper envio-wrapper show-form" ng-show="itemselected === 2">

      <span class="returnlevel" ng-click="returnlevel(2)"></span>

      <div class="forma-de-envio" ng-show="addressLoaded">
        <h2 class="compra-title">DATOS DE ENVÍO</h2>
        <div class="user-data" ng-controller="selectedStatesCitiesController">
          <!-- Nombre -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>NOMBRE</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="name" value="{{addressData.name}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Teléfono  -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>TELÉFONO</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="phone" value="{{addressData.phone}}" class="profile-input"  data-status="acepted" >
              <span class="msgError"></span>
            </div>
          </div>
          <!-- ESTADO -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>ESTADO</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" ng-model="addressState" ng-change="changeState(addressState)" data-status="acepted" name="state">
                <option ng-repeat="(key, data) in states" name="{{data.idEstados}}" value="{{data.idEstados}}">{{data.nombreEstado | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CIUDAD -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CIUDAD</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" ng-model="addressCity" ng-change="changeCity(addressCity)" data-status="acepted" name="city">
                <option ng-repeat="(key, data) in cities" ng-if="data.Estados_idEstados ===  addressState" name="{{data.idCiudades}}" value="{{data.idCiudades}}">{{data.nombreCiudad | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CALLE -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>DIRECCIÓN</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="address" value="{{addressData.address}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- REFERENCIA -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>REFERENCIAS</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="addressdescription" value="{{addressData.addressdescription}}" ng-if="addressData.cartshop === 1" class="profile-input" data-status="acepted">
              <input type="text" name="addressdescription" value="" ng-if="addressData.cartshop === 0" class="profile-input" data-status="denied">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- C.P. -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CÓDIGO POSTAl</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="postalcode" value="{{addressData.postalcode}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
        </div>
        <div class="button-next-wrapper">
          <span class="ocultednextstep" ng-click="changeStage(3)"></span>
          <span class="button-next validSendData">
            SIGUIENTE
          </span>
        </div>
        <span class="errorForm">Favor de verificar todos los campos.</span>
        <div class="message-goto-user">
          Puedes cambiar tu dirección de envió en dado caso de que no quieras que tu compra sea entregada en tu propio domicilio. 
        </div>
      </div>
    </div>

    <!-- CONFIRMAR ORDEN  -->
    <div class="compra-wrapper show-form" ng-show="itemselected === 3">
      <div class="confirm-order">
        <h2 class="compra-title">CONFIRMAR ORDEN</h2>
        <div class="confirm-order-wrapper">
          <div class="confirm-order-top">
            <div class="top-title-order">CANTIDAD</div>
            <div class="top-title-order">PRODUCTO</div>
            <div class="top-title-order">PRECIO</div>
          </div>

          <ul class="order-products-list">
            <li class="order-product-item" ng-repeat="(key, data) in listCart">
              <div class="quantity-order">
                {{data.quantity}}
              </div>
              <div class="product-order">
                <div class="product-order-img">
                  <img style="height: 80px;width: 40px;" src="./admin/src/images/Products/{{data.productimage}}" alt="" />
                </div>
                <div class="product-info">
                  <span class="product-info-title">
                    {{data.productname | uppercase}}
                  </span>
                  <br><br>
                  <span class="product-size">
                    {{data.productquantity}} ml
                  </span>
                </div>
              </div>
              <div class="price-order">
                {{(data.productrealprice * data.quantity) | currency}} <br>
                <span style="color: red" ng-hide="(data.productrealprice - data.productdiscountprice ) == 0">
                  {{(data.productdiscountprice * data.quantity) | currency}}
                </span>
              </div>
            </li>
          </ul>
        </div>

        <div class="total-price-table">

          <div class="row-price">
            <a href=""><span class="mensajeaddcupon">¿Tienes un cupón?</span></a>
            <span class="info-row" style="color: red"></span>
          </div>

          <div class="row-price spaceinputcupon">
            <div>
              <span></span>
              <input type="text" name="cupon" placeholder="Código">
              <button>Aplicar</button>
            </div>
          </div>

          <div class="row-price">
            <span class="info-row">Descuento</span>
            <span class="info-row" style="color: red">{{getPrice() - getDiscount() | currency}}</span>
          </div>
          <div class="row-price">
            <span class="info-row">Subtotal</span>
            <span class="info-row">{{getDiscount() | currency}}</span>
          </div>
          <div class="row-price">
            <span class="info-row">Envio</span>
            <span class="info-row">{{getShippingCost() | currency}}</span>
          </div>
          <br><br>
          <div class="row-price">
            <span class="info-row">TOTAL</span>
            <span class="info-row">{{getDiscount() + getShippingCost() | currency}}</span>
          </div>

        </div>

        <div class="button-paypal-wrapper">
          <div><img src=""></div>
          <div><img src="./src/images/button_paypal01.png"></div>
          <div id="paypal-button"></div>
        </div>
        <script>

          // window.paypalCheckoutReady = function () {
          //   paypal.Button.render({
            
          //     env: 'sandbox', // Specify 'sandbox' for the test environment 'Pruebas: sandbox - Producción: production'

          //     client: {
          //         sandbox:    'AZ_yEN28k2NFLtfpvX0VcU7mxTVKioAxC3Lxt6jzkNQH8hHIeR4JzXfgRTx7i6KyPDO7crvcqUbBgNtU',
          //         // production: 'Aetz7WWmpLGbLvm4-bU2lubUiVf9UNjYycmN0zDSsD93_bUc3bN0G98-myetYkwtmxASOS4CYaHB7FQM'
          //     },

          //     locale: 'es_ES',
          //     style: {
          //       size: 'small',
          //       color: 'orange',
          //       shape: 'pill'
          //     },

          //     payment: function() {
          //       console.log('Comenzar pago');
          //       // Configuración del pago cuando el comprador de click
          //       var env    = this.props.env;
          //       var client = this.props.client;
            
          //       return paypal.rest.payment.create(env, client, {
          //           transactions: [
          //               {
          //                   amount: { total: '1.00', currency: 'USD' }
          //               }
          //           ]
          //       });
          //     },

          //     commit: true, // Opcional: muestre un botón 'Pagar ahora' en el flujo de salida

          //     onAuthorize: function(data, actions) {
          //       console.log('Pago autorizado');
          //       console.log(data);
          //       console.log(actions);
          //       // Ejecuta el pago aqui cuando apruebe la transacción
          //       return actions.payment.get(data).then(function() {
          //         var datas = JSON.parse(data);
          //         alert(datas);
          //       });

          //       // return actions.redirect();
          //       // return actions.payment.execute().then(function() {
          //         // Mostrar una página de éxito al comprador
          //       // });
                  
          //       //Llame a su servidor para ejecutar el pago
          //       // Call your server to execute the payment
            
          //       // if (error === 'INSTRUMENT_DECLINED') {
          //       //     actions.restart();
          //       // }
    
          //     },

          //     onCancel: function(data, actions) {
          //       console.log('Pago cancelado');
          //       console.log(data);
          //       console.log(actions);
          //       // Muestra una página de cancelación o regresa al carrito

          //       // return actions.redirect();
          //     },

          //     onError: function(err) {
          //       console.log(err);
          //       // Mostrar una página de error aquí, cuando se produce un error
          //     }
                    
          //   }, '#paypal-button');
          // };
        </script>

        <script src="https://www.paypalobjects.com/api/checkout.js" data-version-4></script>

        <script>
          
        </script>

      </div>
    </div>
  
  </div>

</div>

