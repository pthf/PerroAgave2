<style type="text/css">
  .errorForm{
    display: block;
    text-align: center;
    margin-top: 5px;
    margin-bottom: 30px;
    font-family: 'Gotham-Bold';
    color: red;
    display: none;
  }
  .ocultednextstep{
    display: none;
  }
  .mensajeaddcupon{
    font-family: 'Gotham-Bold';
  }
  .spaceinputcupon{
    margin-top: 5px;
    margin-bottom: 5px;
  }
  .spaceinputcupon div{
    width: 50%;
    margin-top: 5px;
    margin-bottom: 5px;
  }
  .spaceinputcupon div input{
    border: 1px solid rgb(229, 229, 229);
    padding: 8px;
    font-family: 'Gotham-Book';
    outline: none;
  }
  .spaceinputcupon div span{
    color: red;
    font-size: .9em;
    font-family: 'Gotham-Bold';
    display: block;
    margin: 5px 0px;
    padding-left: 5px;
  }
  .spaceinputcupon div button{
    margin-top: 5px;
    width: auto;
    padding-top: 15px 20px;
    border: 1px solid rgb(229, 229, 229);
    background-color: rgb(229, 229, 229);
    color: #000;
    outline: none;
    font-size: .9em;
    font-family: 'Gotham-Bold';
  }
  .spaceinputcupon div button:hover{
    cursor: pointer;
    opacity: .5;
  }
  .line-not-price{
    text-decoration: line-through;
  }
</style>
<div class="row partial-container shop-stage-buy">
  
  <div class="shopping-cart" ng-controller="shoppingCartController" ng-show="getCount()!=0">
    <!-- Menu -->
    <div class="status-compra">
      <div class="title-status step-2" ng-click="changeItemBuy(1)" ng-class="{'selected-status': itemselected === 1, 'unselected-status': itemselected != 1 }">INFORMACIÓN DEL CLIENTE</div>
      <div class="title-status step-4" ng-click="changeItemBuy(2)" ng-class="{'selected-status': itemselected === 2, 'unselected-status': itemselected != 2 }">DATOS DE ENVÍO</div>
      <div class="title-status step-1" ng-click="changeItemBuy(3)" ng-class="{'selected-status': itemselected === 3, 'unselected-status': itemselected != 3 }">CONFIRMAR ORDEN</div>
    </div>

  
    <!-- INFORMACIÓN DEL CLIENTE -->
    <div class="compra-wrapper client-info-wrapper show-form" ng-show="itemselected === 1">
      <div class="client-info" ng-show="userDataLoaded">
        <h2 class="compra-title">INFORMACIÓN DEL CLIENTE</h2>
        <div class="user-data" ng-controller="selectedStatesCitiesController">
          <!-- Nombre -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>NOMBRE</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="name" value="{{userData.username}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Apellido -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>APELLIDOS</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="lastname" value="{{userData.userlastname}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- E-MAIL -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>E-MAIL</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="email" value="{{userData.useremail}}" data-email="{{userData.useremail}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Teléfono  -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>TELÉFONO</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="phone" value="{{userData.userphonenumber}}" class="profile-input" readonly="true" data-status="acepted" disabled >
              <span class="msgError"></span>
            </div>
          </div>
          <!-- ESTADO -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>ESTADO</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" readonly="true" ng-model="userState" ng-change="changeState(userState)" data-status="acepted" disabled name="state">
                <option ng-repeat="(key, data) in states" name="{{data.idEstados}}" value="{{data.idEstados}}">{{data.nombreEstado | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CIUDAD -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CIUDAD</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" readonly="true" ng-model="userCity" ng-change="changeCity(userCity)" data-status="acepted" disabled name="city">
                <option ng-repeat="(key, data) in cities" ng-if="data.Estados_idEstados ===  userState" name="{{data.idCiudades}}" value="{{data.idCiudades}}">{{data.nombreCiudad | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CALLE -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>DIRECCIÓN</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="address" value="{{userData.useraddress}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- C.P. -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CÓDIGO POSTAl</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="postalcode" value="{{userData.userzipcode}}" class="profile-input" readonly="true" data-status="acepted" disabled>
              <span class="msgError"></span>
            </div>
          </div>
        </div>
        <div class="button-next-wrapper">
          <span class="button-next" ng-click="changeStage(2)">
            SIGUIENTE
          </span>
        </div>
        <div class="message-goto-user">
          En dado caso de que tus datos sean incorrectos, ve a <a href="./#/profile">perfil</a> para cambiarlos. 
        </div>
      </div>
    </div>

    <!-- DATOS DE ENVÍO -->
    <div class="compra-wrapper envio-wrapper show-form" ng-show="itemselected === 2">

      <span class="returnlevel" ng-click="returnlevel(2)"></span>

      <div class="forma-de-envio" ng-show="addressLoaded">
        <h2 class="compra-title">DATOS DE ENVÍO</h2>
        <div class="user-data" ng-controller="selectedStatesCitiesController">
          <!-- Nombre -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>NOMBRE</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="name" value="{{addressData.name}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- Teléfono  -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>TELÉFONO</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="phone" value="{{addressData.phone}}" class="profile-input"  data-status="acepted" >
              <span class="msgError"></span>
            </div>
          </div>
          <!-- ESTADO -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>ESTADO</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" ng-model="addressState" ng-change="changeState(addressState)" data-status="acepted" name="state">
                <option ng-repeat="(key, data) in states" name="{{data.idEstados}}" value="{{data.idEstados}}">{{data.nombreEstado | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CIUDAD -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CIUDAD</span>
            </div>
            <div class="right-side-data">
              <select class="profile-input" ng-model="addressCity" ng-change="changeCity(addressCity)" data-status="acepted" name="city">
                <option ng-repeat="(key, data) in cities" ng-if="data.Estados_idEstados ===  addressState" name="{{data.idCiudades}}" value="{{data.idCiudades}}">{{data.nombreCiudad | uppercase}}</option>
              </select>
              <span class="msgError"></span>
            </div>
          </div>
          <!-- CALLE -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>DIRECCIÓN</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="address" value="{{addressData.address}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- REFERENCIA -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>REFERENCIAS</span>
            </div>
            <div class="right-side-data">
              <input type="text" name="addressdescription" value="{{addressData.addressdescription}}" ng-if="addressData.cartshop === 1" class="profile-input" data-status="acepted">
              <input type="text" name="addressdescription" value="" ng-if="addressData.cartshop === 0" class="profile-input" data-status="denied">
              <span class="msgError"></span>
            </div>
          </div>
          <!-- C.P. -->
          <div class="user-data-row">
            <div class="left-side-data">
              <span>CÓDIGO POSTAl</span>
            </div>
            <div class="right-side-data">
              <input type="tel" name="postalcode" value="{{addressData.postalcode}}" class="profile-input" data-status="acepted">
              <span class="msgError"></span>
            </div>
          </div>
        </div>
        <div class="button-next-wrapper">
          <span class="ocultednextstep" ng-click="changeStage(3)"></span>
          <span class="button-next validSendData">
            SIGUIENTE
          </span>
          <input type="" class="btn btn-default clickUpdate" value=""  name="" style="display:none" ng-click="update()"></input>
        </div>
        <span class="errorForm">Favor de verificar todos los campos.</span>
        <div class="message-goto-user">
          Puedes cambiar tu dirección de envió en dado caso de que no quieras que tu compra sea entregada en tu propio domicilio. 
        </div>
      </div>
    </div>

    <!-- CONFIRMAR ORDEN  -->
    <div class="compra-wrapper show-form" ng-show="itemselected === 3">
      <div class="confirm-order">
        <h2 class="compra-title">CONFIRMAR ORDEN</h2>
        <div class="confirm-order-wrapper">
          <div class="confirm-order-top">
            <div class="top-title-order">CANTIDAD</div>
            <div class="top-title-order">PRODUCTO</div>
            <div class="top-title-order">PRECIO</div>
          </div>

          <ul class="order-products-list">
            <li class="order-product-item" ng-repeat="(key, data) in listCart">
              <div class="quantity-order">
                {{data.quantity}}
              </div>
              <div class="product-order">
                <div class="product-order-img">
                  <img style="height: 80px;width: 40px;" src="./admin/src/images/Products/{{data.productimage}}" alt="" />
                </div>
                <div class="product-info">
                  <span class="product-info-title">
                    {{data.productname | uppercase}}
                  </span>
                  <br><br>
                  <span class="product-size">
                    {{data.productquantity}} ml
                  </span>
                </div>
              </div>
              <div class="price-order">
                <span ng-class="{'line-not-price': (data.productrealprice - data.productdiscountprice ) != 0}"> {{(data.productrealprice * data.quantity) | currency}} </span>
                
                <br>
                
                <span style="color: red" ng-hide="(data.productrealprice - data.productdiscountprice ) == 0">
                  {{(data.productdiscountprice * data.quantity) | currency}}
                </span>
              </div>
            </li>
          </ul>
        </div>

        <div class="total-price-table">

          <div class="row-price">
            <span class="info-row">Subtotal</span>
            <span class="info-row">{{getPrice() | currency}}</span>
          </div>


          <div class="row-price" ng-show="(getPrice() - getDiscount()) != 0">
            <span class="info-row">Descuento</span>
            <span class="info-row" style="color: red">{{getPrice() - getDiscount() | currency}}</span>
          </div>

          <div class="row-price" ng-show="couponApplied">
            <span class="info-row">Descuento cupon </span>
            <span class="info-row" style="color: red">{{((porcentDiscount/100)*getPrice()) | currency}}</span>
          </div>          
          
          <div class="row-price">
            <span class="info-row">Envio</span>
            <span class="info-row">{{costoEnvio | currency}}</span>
          </div><br><br>


        <!-- Costo de envio: {{shippingCost}} -->
        <!-- Costo de envio: {{costoEnvio}} -->
          <div class="row-price">
            <span class="info-row">TOTAL</span>
            <span class="info-row">{{ getDiscount() - ((porcentDiscount/100)*getPrice()) + costoEnvio | currency}}</span>
          </div><br>

          <div class="row-price" ng-show="!couponApplied">
            <a href=""><span class="mensajeaddcupon">¿Tienes un cupón?</span></a>
            <span class="info-row" style="color: red"></span>
          </div>

          <div class="row-price spaceinputcupon">
            <div>
              <span></span>
              <input type="text" name="cupon" placeholder="Código">
              <button>Aplicar</button>
            </div>
          </div>
        </div>

        <div class="button-paypal-wrapper">
          <div>
            <img class="activeFormPaypal" data-shipping-cost="{{costoEnvio}}" src="">
          </div>
          <div><img src="./src/images/button_paypal01.png"></div>
          <form action="./php/startPayment.php" method="POST">
            <table hidden>
              <tr><td>Costo envío </td><td><input class="form-control" type="text" name="costoEnvio" value="{{costoEnvio}}" readonly></input></td></tr>
              <tr><td>Total </td><td><input class="form-control" type="text" name="total" value="{{ getDiscount() - ((porcentDiscount/100)*getPrice()) + costoEnvio}}" readonly></input></td></tr>
            </table>
            <div id="myContainer"></div>
            <br>
          </form>
        </div>
        <!-- PayPal In-Context Checkout script -->
        <script type="text/javascript">
          // window.paypalCheckoutReady = function () {
          //   paypal.checkout.setup('RHZN38B7X9FL8', {
          //     container: 'myContainer', //{String|HTMLElement|Array} where you want the PayPal button to reside
          //     environment: 'sandbox' //or 'production' depending on your environment
          //   });
          // };
        </script>
        <script src="//www.paypalobjects.com/api/checkout.js" async></script>

      </div>
    </div>
  
  </div>

</div>

